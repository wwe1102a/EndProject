<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, width=device-width" />
    <script src="https://js.api.here.com/v3/3.1/mapsjs-core.js"></script>
    <script src="https://js.api.here.com/v3/3.1/mapsjs-service.js"></script>
    <script type="text/javascript" src="https://js.api.here.com/v3/3.1/mapsjs-mapevents.js"></script>
    <script type="text/javascript" src="https://js.api.here.com/v3/3.1/mapsjs-ui.js" ></script>
    <link rel="stylesheet" type="text/css" href="https://js.api.here.com/v3/3.1/mapsjs-ui.css" />
  </head>



  <body>
    <div style="margin: auto; width: 100vw; height: 100vw" id="mapContainer"></div>
    <script>
      // Initialize the platform object
      var platform = new H.service.Platform({
        'apikey': 'vhuh8tZ13db680ljmKdcJ-ywdHQEN9EpzNxJGcLf4xs'
      });

      // Obtain the default map types from the platform object
      var maptypes = platform.createDefaultLayers();

      // Instantiate (and display) the map
      var map = new H.Map(
        document.getElementById('mapContainer'),
        maptypes.vector.normal.map,
        {
          zoom: 10,
          center: { lng: 100.303441, lat: 13.7250482 } 
        });

      // Create the default UI:
      const ui = H.ui.UI.createDefault(map, maptypes);

      // Enable the event system to capture user inputs
      var mapEvents = new H.mapevents.MapEvents(map);

      // Instantiate the default behavior (dragging, zooming, etc.)
      var behavior = new H.mapevents.Behavior(mapEvents);

      const zoomRectangle = new H.ui.ZoomRectangle({

      // Position the control on the map's viewport
      alignment: H.ui.LayoutAlignment.LEFT_BOTTOM
      });


      ui.addControl('rectangle', zoomRectangle);

      //Chanon Sahanon Edited: 10/10/24 19.08
      var markers = [];


      //add and remove markers
      function addMarker(coords) {
        var marker = new H.map.Marker(coords);

        //remove
        /*marker.addEventListener('tap', function() {
          map.removeObject(marker);
          markers = markers.filter(m => m !== marker);
          evt.stopPropagation();
        });*/
        
        // Create an info bubble with custom text
        var bubble = new H.ui.InfoBubble(coords, {
        content: `<div>กุจะบ้าตาย</div>` // Custom content here
         });

        // Show the info bubble when the marker is tapped
         marker.addEventListener('tap', function () {

        // Add the bubble to the UI
        ui.addBubble(bubble);
        });


        //add Marker to array
        map.addObject(marker);
        markers.push(marker);
      }


      var initialCoords = {lng: 100.303441, lat: 13.7250482};
      addMarker(initialCoords);

      map.setCenter(initialCoords);

      map.addEventListener('tap', function(evt) {

        // Check if the clicked element is not part of the bubble UI
        if (evt.target instanceof H.map.Marker) {
        // Do nothing if the tap is on a marker
        return;
        
    }
        
        var coords = map.screenToGeo(evt.currentPointer.viewportX, evt.currentPointer.viewportY);

        addMarker({ lat: coords.lat, lng: coords.lng});
          
      }) ;
      // Stop event propagation when closing the bubble
      ui.addEventListener('tap', function (evt) {
          evt.stopPropagation();
      });


    

      const spireCoordinates = {
      lat: 13.7250482,
      lng: 100.303441
      };

      
      
      

      

      
     


    
    </script>

  </body>
</html>